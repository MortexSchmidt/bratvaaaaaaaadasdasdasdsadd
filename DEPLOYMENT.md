# Деплой на Railway

## Подготовка к деплою

1. Убедитесь, что у вас есть аккаунт на [Railway](https://railway.app)
2. Установите CLI инструмент Railway:
```bash
npm install -g @railway/cli
```
или
```bash
curl -fsSL https://railway.app/install.sh | bash
```

## Деплой через GitHub (рекомендуется)

1. Запушьте ваш код в репозиторий GitHub
2. Перейдите на [Railway Dashboard](https://railway.app/dashboard)
3. Нажмите "New Project"
4. Выберите "Deploy from GitHub"
5. Выберите ваш репозиторий
6. Railway автоматически обнаружит файл `Procfile` и настроит деплой

## Настройка переменных окружения

После создания проекта настройте переменные окружения:

1. Перейдите во вкладку "Variables" в панели управления Railway
2. Добавьте следующие переменные:

```
BOT_TOKEN = "ваш_токен_телеграм_бота"
WEB_APP_URL = "https://ваше-имя-проекта.up.railway.app/mini_apps/truth_or_dare/"
```

### Получение токена бота

1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания нового бота
4. Скопируйте токен, который BotFather выдаст вам

## Альтернативный способ: Деплой через CLI

1. Войдите в аккаунт Railway:
```bash
railway login
```

2. Инициализируйте проект:
```bash
railway init
```

3. Установите переменные окружения:
```bash
railway vars set BOT_TOKEN="ваш_токен_бота"
railway vars set WEB_APP_URL="https://ваше-имя-проекта.up.railway.app/mini_apps/truth_or_dare/"
```

4. Деплой проекта:
```bash
railway up
```

## Проверка работоспособности

После деплоя:

1. Убедитесь, что приложение успешно запустилось во вкладке "Logs"
2. Перейдите по URL вашего приложения (в формате `https://ваше-имя-проекта.up.railway.app`)
3. Проверьте, что Mini-App доступна по адресу `/mini_apps/truth_or_dare/`
4. Проверьте API по адресу `/api/health`

## Возможные проблемы и решения

### Проблема: "Bot token not provided"
**Решение**: Убедитесь, что переменная `BOT_TOKEN` установлена правильно в настройках Railway

### Проблема: "Port not specified"
**Решение**: Приложение автоматически использует переменную `PORT`, предоставленную Railway

### Проблема: Mini-App не загружается
**Решение**: Проверьте, что `WEB_APP_URL` указывает на правильный домен Railway

## Автоматические деплои

Для настройки автоматических деплоев при пуше в GitHub:

1. Перейдите во вкладку "Settings" проекта на Railway
2. Найдите раздел "GitHub"
3. Включите автоматические деплои
4. Выберите ветку, из которой будет происходить деплой (обычно `main` или `master`)

## Мониторинг и логирование

- Используйте вкладку "Logs" в панели управления Railway для просмотра логов приложения
- Вкладка "Metrics" показывает использование ресурсов
- Для отладки проблем проверяйте логи при запуске и во время работы приложения

## Ограничения бесплатного тарифа

- Приложение может "спать" после периода бездействия
- Перезапуск может занять несколько секунд
- Ограниченные ресурсы (256MB RAM, 1 CPU)