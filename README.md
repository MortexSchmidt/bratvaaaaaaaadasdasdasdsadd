# Telegram Bot с Mini-App "Правда или Действие 2.0"

Этот проект представляет собой Telegram бота с интегрированной Mini-App "Правда или Действие 2.0", которая предоставляет улучшенный игровой опыт с современным дизайном и расширенным функционалом.

## Особенности

- **Улучшенная Mini-App**: Современный интерфейс с анимациями, темной/светлой темой и плавными переходами
- **Различные режимы игры**: "По часовой стрелке" и "Кому угодно"
- **Настройка сложности**: Возможность выбора уровня сложности заданий (безопасные, острые, рискованные)
- **Безопасная аутентификация**: Использование WebApp initData для безопасной передачи данных
- **Полная интеграция**: Работает как в Mini-App, так и в классическом режиме бота
- **Адаптивный дизайн**: Подходит для разных размеров экранов

## Технический стек

- **Backend**: Python, aiogram 3.3.0, Flask
- **Frontend**: HTML, CSS, JavaScript
- **Telegram WebApp API**: Для интеграции с Mini-App
- **Flask-CORS**: Для обработки кросс-доменных запросов

## Структура проекта

```
bot/
├── app/
│   ├── handlers/          # Обработчики команд бота
│   ├── mini_apps/         # Mini-App "Правда или Действие"
│   │   └── truth_or_dare/ # Улучшенная версия игры
│   └── ...
├── requirements.txt       # Зависимости Python
├── Procfile              # Конфигурация для Railway
├── run.py                # Точка входа для бота
└── start_app.py          # Точка входа для запуска обоих приложений
```

## Установка и запуск

### Локальный запуск

1. Клонируйте репозиторий:
```bash
git clone <ваш_репозиторий>
cd bratva
```

2. Установите зависимости:
```bash
pip install -r bot/requirements.txt
```

3. Создайте файл `.env` в корне проекта:
```env
BOT_TOKEN=ваш_токен_бота
WEB_APP_URL=https://ваш-домен.herokuapp.com/mini_apps/truth_or_dare/
```

4. Запустите приложение:
```bash
python bot/start_app.py
```

### Деплой на Railway

1. Создайте аккаунт на [Railway](https://railway.app)
2. Установите CLI инструмент: `npm install -g @railway/cli`
3. Войдите в аккаунт: `railway login`
4. Создайте новый проект: `railway init`
5. Установите переменные окружения:
   - `BOT_TOKEN`: токен вашего Telegram бота
   - `WEB_APP_URL`: URL вашего приложения на Railway
6. Деплой: `railway up`

## Функциональность

### Mini-App "Правда или Действие 2.0"

- **Создание лобби**: Игроки могут создавать лобби и приглашать друзей
- **Режимы игры**: 
 - По часовой стрелке: задания передаются следующему игроку
  - Кому угодно: игрок сам выбирает, кому дать задание
- **Настройка правил**: 
 - С правилами: ограничены пасы, безопасные задания
  - Без правил: неограниченные пасы, любая сложность
- **Уровни сложности**: 
  - Безопасно: легкие и веселые задания
  - Остро: более личные вопросы
  - Рискованно: самые смелые задания
- **История заданий**: Отслеживание выполненных заданий
- **Прогресс игры**: Визуальный индикатор прогресса

### Интеграция с ботом

- Команда `/truthordare` предлагает выбор между классической версией и улучшенной Mini-App
- Безопасные ссылки с аутентификацией для доступа к Mini-App
- Полная совместимость с существующими функциями бота

## Конфигурация для Railway

Файл `Procfile` настроен для запуска обоих приложений (бота и Mini-App) в одном контейнере:

```
web: python bot/start_app.py
```

Файл `requirements.txt` включает все необходимые зависимости для обоих приложений.

## Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой фичи: `git checkout -b feature-name`
3. Сделайте коммит изменений: `git commit -m 'Add some feature'`
4. Запушьте ветку: `git push origin feature-name`
5. Откройте Pull Request

## Лицензия

Этот проект распространяется под MIT лицензией.

## Безопасность и ротация токенов

Если токен бота был опубликован (в чате, в коммите, в issue, логах) — его НУЖНО немедленно отозвать:

1. Открыть BotFather → команда `/revoke` → выбрать бота → получить новый токен.
2. Обновить локальный `.env` и переменные окружения на сервере / Railway / Render.
3. Перезапустить процессы.
4. Убедиться что старый токен больше не работает (старый бот перестал отвечать, новый отвечает).

Файл `.env` уже исключён через `.gitignore`. Чтобы поделиться конфигом — используйте `bot/.env.example`.

Минимальный пример `.env`:
```
BOT_TOKEN=123456:ABCDEF_new_token_here
ADMINS=123456789
WEB_APP_URL=https://your-domain.example/mini_apps/truth_or_dare/
OPENAI_API_KEY=
HUGGINGFACE_TOKEN=
```

Никогда не коммить реальный токен и API ключи. При сомнениях — выполнить ротацию.
